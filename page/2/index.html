<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>vhuichen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="vhuichen">
<meta property="og:url" content="https://vhuichen.github.io/page/2/index.html">
<meta property="og:site_name" content="vhuichen">
<meta property="og:locale">
<meta property="article:author" content="vhuichen">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="vhuichen" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">vhuichen</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">记录、分享</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://vhuichen.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-iOS/iOS检测未使用的类" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/iOS/iOS%E6%A3%80%E6%B5%8B%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B1%BB/" class="article-date">
  <time class="dt-published" datetime="2021-04-12T16:00:00.000Z" itemprop="datePublished">2021-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/iOS/iOS%E6%A3%80%E6%B5%8B%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B1%BB/">iOS检测未使用的类</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>两种方法<br>1、machO文件中 通过 <code>__objc_classlist</code>  <code>__objc_classrefs</code> 对比<br>2、运行时获取到未使用的类（需要大量测试，或者线上测试）<br>两种方法都不能绝对识别准确，但合并起来准确率很高了，最终再手动确定   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;dlfcn.h&gt;</span><br><span class="line">#include &lt;mach-o/dyld.h&gt;</span><br><span class="line">#include &lt;mach-o/getsect.h&gt;</span><br><span class="line"></span><br><span class="line">/* 获取 runtime 未使用的类 */</span><br><span class="line">NSMutableSet&lt;NSString *&gt; *runtimeUnusedClass() &#123;</span><br><span class="line">    Dl_info info;</span><br><span class="line">    dladdr((const void *)&amp;runtimeUnusedClass, &amp;info);</span><br><span class="line">    </span><br><span class="line">    const uint64_t mach_header = (uint64_t)info.dli_fbase;</span><br><span class="line">    </span><br><span class="line">    const struct section_64 *classlist = getsectbynamefromheader_64((const struct mach_header_64 *)mach_header, &quot;__DATA&quot;, &quot;__objc_classlist&quot;);</span><br><span class="line">    </span><br><span class="line">    if (classlist) &#123;</span><br><span class="line">        NSMutableSet *classlistUnused = [[NSMutableSet alloc] init];</span><br><span class="line">        // 遍历拿到所有的类</span><br><span class="line">        for (UInt64 addr = classlist-&gt;offset; addr &lt; classlist-&gt;offset + classlist-&gt;size; addr += sizeof(const char **)) &#123;</span><br><span class="line">            uint64_t baseArrr = mach_header + addr;</span><br><span class="line">            </span><br><span class="line">            //获取类对象指针</span><br><span class="line">            uint64_t object_class_addr = *(uint64_t *)(baseArrr);</span><br><span class="line">            //</span><br><span class="line">            uint64_t object_class_isa = *(uint64_t *)(object_class_addr);</span><br><span class="line">            //获取元类对象</span><br><span class="line">            uint64_t object_meta_class_addr;</span><br><span class="line">            if (object_class_isa &amp; (1 &lt;&lt; 0)) &#123;</span><br><span class="line">                object_meta_class_addr = object_class_addr;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                object_meta_class_addr = object_class_isa &amp; 0x00007ffffffffff8ULL;</span><br><span class="line">            &#125;</span><br><span class="line">            //偏移32个字节，拿到 class_data_bits 的地址</span><br><span class="line">            uint64_t class_data_bits_addr = object_meta_class_addr + 32;</span><br><span class="line">            //取 class_data_bits 的值</span><br><span class="line">            uint64_t class_data_bits = *(uint64_t *)(class_data_bits_addr);</span><br><span class="line">            //得到 class_rw_t 的指针 (class_rw_t *)(bits &amp; FAST_DATA_MASK);</span><br><span class="line">            uint64_t class_rw_addr = (class_data_bits &amp; 0x00007ffffffffff8UL);</span><br><span class="line">            //取指针的值，得到的第一个数据就是 flags</span><br><span class="line">            uint64_t flags = *(uint64_t *)(class_rw_addr);</span><br><span class="line">            //</span><br><span class="line">            bool isInitialized = flags &amp; (1 &lt;&lt; 29);</span><br><span class="line">            </span><br><span class="line">            if (!isInitialized) &#123;</span><br><span class="line">                //打印类会导致类初始化，所以此方法只能使用一次</span><br><span class="line">                NSString *class = [NSString stringWithFormat:@&quot;%@&quot;, (void *)object_class_addr];</span><br><span class="line">                [classlistUnused addObject:class];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return classlistUnused;</span><br><span class="line">    &#125;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 获取 MachO 未使用的类 */</span><br><span class="line">NSMutableSet&lt;NSString *&gt; *machOUnusedClass() &#123;</span><br><span class="line">    Dl_info info;</span><br><span class="line">    dladdr((const void *)&amp;machOUnusedClass, &amp;info);</span><br><span class="line">    </span><br><span class="line">    const uint64_t mach_header = (uint64_t)info.dli_fbase;</span><br><span class="line">    </span><br><span class="line">    const struct section_64 *classlist = getsectbynamefromheader_64((const struct mach_header_64 *)mach_header, &quot;__DATA&quot;, &quot;__objc_classlist&quot;);</span><br><span class="line">    const struct section_64 *selfrefs = getsectbynamefromheader_64((const struct mach_header_64 *)mach_header, &quot;__DATA&quot;, &quot;__objc_classrefs&quot;);</span><br><span class="line">    </span><br><span class="line">    if (classlist &amp;&amp; selfrefs) &#123;</span><br><span class="line">        NSMutableSet *classlistSet = [[NSMutableSet alloc] init];</span><br><span class="line">        for (UInt64 addr = classlist-&gt;offset; addr &lt; classlist-&gt;offset + classlist-&gt;size; addr += sizeof(const char **)) &#123;</span><br><span class="line">            uint64_t baseArrr = mach_header + addr;</span><br><span class="line">            Class cls = (__bridge Class)(*(void **)(baseArrr));</span><br><span class="line">            NSString *clsString = [NSString stringWithFormat:@&quot;%@&quot;,cls];</span><br><span class="line">            [classlistSet addObject:clsString];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        NSMutableSet *selfrefsSet = [[NSMutableSet alloc] init];</span><br><span class="line">        for (UInt64 addr = selfrefs-&gt;offset; addr &lt; selfrefs-&gt;offset + selfrefs-&gt;size; addr += sizeof(const char **)) &#123;</span><br><span class="line">            uint64_t baseArrr = mach_header + addr;</span><br><span class="line">            </span><br><span class="line">            Class cls = (__bridge Class)(*(void **)(baseArrr));</span><br><span class="line">            while (cls) &#123;</span><br><span class="line">                [selfrefsSet addObject:[NSString stringWithFormat:@&quot;%@&quot;,cls]];</span><br><span class="line">                cls = [cls superclass];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        [classlistSet minusSet:selfrefsSet];</span><br><span class="line">        </span><br><span class="line">        return  classlistSet;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>1、<code>runtimeUnusedClass</code> 方法只有在第一次调用有效，而且必须手动浏览所有的页面（可以考虑放到线上收集）<br>2、两种方法都是不准确的，但未使用的类一定在其中，最终需要手动再次确认。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2021/04/iOS/iOS%E6%A3%80%E6%B5%8B%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B1%BB/" data-id="cl7mpcyqw001bgczydsorf1k7" data-title="iOS检测未使用的类" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BD%93%E7%A7%AF%E5%8C%85%E4%BC%98%E5%8C%96/" rel="tag">体积包优化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-OperatingSystem/线程&amp;进程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/OperatingSystem/%E7%BA%BF%E7%A8%8B&%E8%BF%9B%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2021-03-27T16:00:00.000Z" itemprop="datePublished">2021-03-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/OperatingSystem/%E7%BA%BF%E7%A8%8B&%E8%BF%9B%E7%A8%8B/">线程&amp;进程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="线程-amp-进程"><a href="#线程-amp-进程" class="headerlink" title="线程&amp;进程"></a>线程&amp;进程</h3><h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>程序执行的一个实例，表示一个正在运行的程序，是系统进行资源分配的基本单元，拥有一个完整的虚拟地址空间。</p>
<h4 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h4><p>轻量级进程，程序执行的最小单元，是进程里面的一个实体，线程与资源分配无关，线程自己不拥有资源（只有少量寄存器、栈、线程控制表TCB），线程依赖进程，并与进程内其他线程共享资源。</p>
<h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><p><code>调度</code>：线程是程序调度、分配的基本单位，而进程拥有资源，各司其职，显著的提高系统的并发运行。同一个进程中，线程切换，进程不需要切换，而进程切换，线程也必须切换。线程切换只需要保存自己的寄存器以及堆栈数据，线程切换还需要分配新的资源。<br><code>并发性</code>：进程之间可以并发，一个进程内的多个线程亦可并发，利用好线程的并发性可以更好地利用资源<br><code>资源</code>：线程只拥有少量资源（寄存器、栈），但可以使用进程的资源<br><code>系统开销</code>：进程切换开销大于线程切换的开销（<code>进程</code>：切换虚拟地址空间、切换CPU上下文、切换内核栈  <code>线程</code>：切换CPU上下文、切换内核栈）<br><code>通信方式</code>：进程间通信需要通过IPC（本身也是一个程序），而线程间通信只是简单的读写数据段。进程资源互不影响，而线程资源则要考虑同步、互斥的问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">页表可以将虚拟地址转换为物理内存地址，页表查找很慢，通常使用缓存来加快查找，切换进程，意味着虚拟内存切换、页表切换，从而导致缓存命中率低，查找变慢 </span><br><span class="line"></span><br><span class="line">页表: 类似于字典一个虚拟地址对应一个物理地址，真实机制没搞懂 </span><br><span class="line">虚实地址的映射关系是通过页表来描述的，而mmu正是通过页表来查找虚地址所对应的物理地址。 </span><br></pre></td></tr></table></figure>

<p>进程的上下文切换不仅包含了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内核空间的资源。</p>
<h4 id="我自己理解的线程-amp-进程"><a href="#我自己理解的线程-amp-进程" class="headerlink" title="我自己理解的线程&amp;进程"></a>我自己理解的线程&amp;进程</h4><p>进程就是正在执行的程序，线程就是这个程序的最小执行单元，一个进程通常拥有多个线程。进程拥有独立的资源以及虚拟地址空间，而线程只拥有寄存器、栈等少量资源，但进程内部的线程可以共享进程的资源，包括虚拟内存地址。</p>
<h4 id="为什么进程切换比线程切换耗资源"><a href="#为什么进程切换比线程切换耗资源" class="headerlink" title="为什么进程切换比线程切换耗资源"></a>为什么进程切换比线程切换耗资源</h4><ul>
<li>线程切换就是栈、寄存器的切换。  </li>
<li>进程的切换不仅包含了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内核空间的资源。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2021/03/OperatingSystem/%E7%BA%BF%E7%A8%8B&%E8%BF%9B%E7%A8%8B/" data-id="cl7mpcyqp000ugczyaoxphihf" data-title="线程&amp;进程" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B/" rel="tag">线程</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BF%9B%E7%A8%8B/" rel="tag">进程</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-NetworkProtocol/了解 WebSocket" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/NetworkProtocol/%E4%BA%86%E8%A7%A3%20WebSocket/" class="article-date">
  <time class="dt-published" datetime="2021-03-19T16:00:00.000Z" itemprop="datePublished">2021-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">网络协议</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/NetworkProtocol/%E4%BA%86%E8%A7%A3%20WebSocket/">了解 WebSocket</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>Websocket 处于应用层协议，他必须依赖 HTTP 协议进行一次握手，握手成功后直接通过单个 TCP 传输数据。<br>Websocket 是为了解决 HTTP 轮询、长轮询的问题</p>
<ul>
<li>轮询：每隔一定时间发出一个请求，耗资源</li>
<li>长轮询：客户端发送一个超长时间的请求，服务器hold住这个请求，直到有新数据时返回</li>
</ul>
<h3 id="WebSocket-amp-Socket"><a href="#WebSocket-amp-Socket" class="headerlink" title="WebSocket &amp; Socket"></a>WebSocket &amp; Socket</h3><p>Socket 本身并不是一个协议。它工作在 OSI 模型会话层（第5层），是为了方便大家直接使用更底层协议（一般是 TCP 或 UDP ）而存在的一个抽象层。Socket是对TCP&#x2F;IP协议的封装，Socket本身并不是协议，而是一个调用接口(API)。<br>Socket 可以指定不同的传输协议（TCP 、UDP）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebSocket 和 Socket 本质没有什么关系。WebSocket 基于 TCP ，Socket 可以基于 TCP、UDP</span><br></pre></td></tr></table></figure>

<h3 id="WebSocket-amp-HTTP"><a href="#WebSocket-amp-HTTP" class="headerlink" title="WebSocket &amp; HTTP"></a>WebSocket &amp; HTTP</h3><ul>
<li>HTTP 是基于<code>请求-应答</code>的方式，WebSocket是双向通信的  </li>
<li>WebSocket 连接使用的是HTTP协议进行连接的，发送了一个标记了 Upgrade 字段的请求，定义了一系列新的header域，标明是 WebSocket 连接。</li>
<li>都是基于TCP的应用层协议。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2021/03/NetworkProtocol/%E4%BA%86%E8%A7%A3%20WebSocket/" data-id="cl7mpcyqo000qgczy7pq21gw8" data-title="了解 WebSocket" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-NetworkProtocol/Socket" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/NetworkProtocol/Socket/" class="article-date">
  <time class="dt-published" datetime="2021-03-18T16:00:00.000Z" itemprop="datePublished">2021-03-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">网络协议</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/NetworkProtocol/Socket/">Socket</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h1><p>网络中不同主机上的应用进程之间进行双向通信的端点的抽象。<br>Socket 本身并不是一个协议，而是一个调用接口。它工作在 OSI 模型会话层，是为了方便大家直接使用更底层协议（一般是 TCP 或 UDP ）而存在的一个抽象层。Socket 是对 TCP&#x2F;IP 协议的封装。</p>
<h2 id="Socket-连接流程"><a href="#Socket-连接流程" class="headerlink" title="Socket 连接流程"></a>Socket 连接流程</h2><p>创建 Socket 的时候，可以指定网络层使用的是 IPv4 还是 IPv6，传输层使用的是 TCP 还是 UDP。</p>
<img src="https://gitee.com/vhuichen/images/raw/master/img/20210419122732.png" width="500">

<h3 id="TCP方式-服务器"><a href="#TCP方式-服务器" class="headerlink" title="TCP方式 服务器"></a>TCP方式 服务器</h3><ul>
<li>创建套接字（socket）  </li>
<li>将套接字绑定到一个本地地址和端口上（bind）<br>  当内核收到TCP报文，会通过端口号找到对应的Socket</li>
<li>将套接字设为监听模式，准备接收客户端请求（listen）  </li>
<li>等待客户请求到来，当请求到来后，接收连接请求，返回一个新的对应于此次连接的套接字（accept）<br>  监听 Socket 和真正用来传数据的 Socket 是两个，<code>监听 Socket</code> 以及 <code>已连接 Socket</code></li>
<li>用返回的套接字和客户端进行通信（send&#x2F;recv）  </li>
<li>返回，等待另一客户请求  </li>
<li>关闭套接字</li>
</ul>
<p>在 TCP 连接时，内核为每个 Socket 维护两个队列  </p>
<ul>
<li>TCP 半连接队列，还没完全建立连接的队列</li>
<li>TCP 全连接队列，已经建立连接的队列</li>
</ul>
<h3 id="TCP方式-客户端"><a href="#TCP方式-客户端" class="headerlink" title="TCP方式 客户端"></a>TCP方式 客户端</h3><ul>
<li>创建套接字（socket）  </li>
<li>向服务器发出连接请求（connect）  </li>
<li>和服务器端进行通信（send&#x2F;recv）  </li>
<li>关闭套接字</li>
</ul>
<h3 id="UDP方式-服务器端"><a href="#UDP方式-服务器端" class="headerlink" title="UDP方式 服务器端"></a>UDP方式 服务器端</h3><ul>
<li>创建套接字（socket）  </li>
<li>将套接字绑定到一个本地地址和端口上（bind）  </li>
<li>等待接收数据（recvfrom）  </li>
<li>关闭套接字</li>
</ul>
<h3 id="UDP方式-客户端"><a href="#UDP方式-客户端" class="headerlink" title="UDP方式 客户端"></a>UDP方式 客户端</h3><ul>
<li>创建套接字（socket）  </li>
<li>向服务器发送数据（sendto）  </li>
<li>关闭套接字</li>
</ul>
<h3 id="如何保证-Socket-的长连接"><a href="#如何保证-Socket-的长连接" class="headerlink" title="如何保证 Socket 的长连接"></a>如何保证 Socket 的长连接</h3><p>应用层自己实现心跳包</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2021/03/NetworkProtocol/Socket/" data-id="cl7mpcyqm000jgczyf4z81xr8" data-title="Socket" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Socket/" rel="tag">Socket</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-iOS/MVC、MVP、MVVM框架" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/iOS/MVC%E3%80%81MVP%E3%80%81MVVM%E6%A1%86%E6%9E%B6/" class="article-date">
  <time class="dt-published" datetime="2021-03-13T16:00:00.000Z" itemprop="datePublished">2021-03-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/iOS/MVC%E3%80%81MVP%E3%80%81MVVM%E6%A1%86%E6%9E%B6/">MVC、MVP、MVVM框架</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-----
title: MVC、MVP、MVVM框架  
categories:   
- iOS开发  
- 框架   
tags:   
- MVC   
- MVP   
- MVVM   
date: 2021-03-14  

----->



<h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><p>苹果的 UIVieController 就是根据 MVC 框架来设计的，UIVieController 持有 View 跟 Model（自己实现），对于一个简单的页面而言在 UIVieController 负责处理业务逻辑，View 负责显示 UI 以及接受用户事件，并将事件传递给 UIVieController，而 Model 负责存储数据。</p>
<h3 id="庞大的-C"><a href="#庞大的-C" class="headerlink" title="庞大的 C"></a>庞大的 C</h3><p>苹果的 MVC 中， C 包含了大量的代码，包括：设置 View 的代码，监听 Model 的代码，网络相关业务逻辑，页面跳转逻辑，这些都是在 C 中实现的。Model 中仅仅包含一些数据，简简单单的一个瘦Model，或者可以将部分数据组装、格式化的逻辑放在 Model 中，让这个 Model 慢慢变成胖Model。<br>而在传统的 MVC 中，Model 是负责网络相关的业务逻辑的，数据通过 Model 提供的接口异步获取，所有跟数据相关的逻辑都应该放在 Model 中。这样做似乎更加合理，但是我在 iOS 开发中却很少见到这样的代码</p>
<h3 id="分离-C-中的代码"><a href="#分离-C-中的代码" class="headerlink" title="分离 C 中的代码"></a>分离 C 中的代码</h3><ol>
<li>设置 View 的代码 可以放在 View 里面（或者 View 分类），事实上我见到的代码很多都是这样做的，甚至不可避免的在 View 中 还会包含一些简单的展示逻辑。此时也可以将监听的代码放在 View 中实现。考虑到苹果原生的 KVO 好多坑，这里可以用 Facebook 的 KVOController 这个库。</li>
<li>网络逻辑本应该放在 Model 中的，但是没放，所以可以将网络逻辑抽出来放在一个单独的文件中，将返回的数据处理好后再交给 Model</li>
<li>分模块，很多 MVC 之所以会“肿”，是因为将 UIVieController 完全当成 C 了，对于一些业务分开的界面，完全可以单独写成一个 MVC 。这样更加合理，也方便修改。对于很复杂的页面，例如包含 UITableView 的页面，就应该将 UITableView 相关的逻辑写成一个 MVC ，每种不同的类型的 UITableViewCell 写成一个 MVC ，最终变成 UITableView（MVC）+ N种类型的 UITableViewCell（MVC）。（PS：实际上项目中这里我都写成 MVC + MVVM 了，不过思想是一样的）</li>
</ol>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>简单，很容易上手</li>
<li>相比于其他框架，MVC代码量最少，非常适用于一些业务简单的页面</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>不太适用于较复杂的页面</li>
<li>业务逻辑都写在 C 中，但 C 和 V 紧密联系在一起，边界缺失，很难对 C 进行单元测试。想象一下，假如现在需要测试 C ，那么 C 的接口在哪里？</li>
</ol>
<h2 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h2><p>MVP 改进了 MVC，将原来 C 中的业务移到 P 中，V 和 P 通过接口通信 ，感觉好像跟 MVC 没什么区别啊！？？其实是有的<br>最明显的区别就是 MVP 中可以对 P 跟 M  进行单元测试，V 持有 P ，P 持有 M，这样我们很容易模拟 V ， 从而对 P 跟 M 进行单元测试。</p>
<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><ol>
<li>易测试，可以对 P 跟 M  进行单元测试</li>
</ol>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>V 和 P 之间引入了大量的接口</li>
</ol>
<h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p>MVVM 改进了 MVP，通过双向绑定机制解决了 MVP 接口很多的问题，MVVM 中的 VM 对应 MVP 的 P，负责处理业务逻辑。通过绑定机制，当 M 发生改变时更新 VM ，VM 发生改变时更新 V ，这些数据更新都不需要通过接口实现。在 iOS 中，这种绑定机制可以用 ReactiveCocoa 或者用 Facebook 的 KVOController + KVC 实现。   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS：使用 Swift 自身的特性应该可以更好地实现 MVVM，但由于本人目前不太熟悉 Swift ，Demo 中并没有使用 Swift 自身的特性</span><br></pre></td></tr></table></figure>

<h3 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h3><ol>
<li>易测试，可以对 VM  进行单元测试</li>
<li>双向绑定简化代码</li>
</ol>
<h3 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>双向绑定使得查找 bug 变难</li>
</ol>
<h3 id="MVVM-vs-MVC-VM"><a href="#MVVM-vs-MVC-VM" class="headerlink" title="MVVM  vs  MVC-VM"></a>MVVM  vs  MVC-VM</h3><p>在实际开发中不使用绑定机制也可以将数据相关的业务放在 VM 中，这样整个框架看起来就像是 MVC-VM，同样也可以对 VM 进行单元测试。在不使用 ReactiveCocoa 的情况下，这种代码框架在我接触的项目中占比很大，其实很多文章把这种代码框架也叫做 MVVM</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>MVC 简单易上手，但很难进行单元测试（其实，项目开发本来就很少单元测试，甚至没有）</li>
<li>MVP 改进了 MVC ，使得 MVP 很容易进行单元测试，但同时也使得 V 和 P 之间出现一堆交互接口</li>
<li>MVVM 改进了 MVP，使用双向绑定简化了 V 和 P 之间的交互接口</li>
<li>在没有使用 ReactiveCocoa 等框架的情况下，使用没有绑定机制的 MVVM（MVC-VM） 也是个不错的选择</li>
</ol>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p><a target="_blank" rel="noopener" href="https://github.com/vhuichen/Architecture">Demo</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2021/03/iOS/MVC%E3%80%81MVP%E3%80%81MVVM%E6%A1%86%E6%9E%B6/" data-id="cl7mpcyqt0011gczy8yry2dzy" data-title="MVC、MVP、MVVM框架" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/" rel="tag">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVP/" rel="tag">MVP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVVM/" rel="tag">MVVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Swift/基础/Swift as as! as? 的理解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/Swift/%E5%9F%BA%E7%A1%80/Swift%20as%20as!%20as?%20%E7%9A%84%E7%90%86%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2020-08-24T16:00:00.000Z" itemprop="datePublished">2020-08-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Swift/">Swift</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/Swift/%E5%9F%BA%E7%A1%80/Swift%20as%20as!%20as?%20%E7%9A%84%E7%90%86%E8%A7%A3/">Swift as as! as? 的理解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>目前公司项目中用到的 Swift 比较少，所以对 Swift 的理解也很局限。这里把一些放在笔记中的内容整理下分享出来。</p>
<h2 id="as"><a href="#as" class="headerlink" title="as"></a>as</h2><p>编译时检测,有两个意思<br>1、指定文字表达类型<br>2、upcast（向上转型，转换成其父类类型）</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指定 1 的类型为 CGFloat 类型，既变量 num 为 CGFloat 类型</span></span><br><span class="line"><span class="keyword">let</span> num <span class="operator">=</span> <span class="number">1</span> <span class="keyword">as</span> <span class="type">CGFloat</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>: <span class="title class_">Animal</span> &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> dog <span class="operator">=</span> <span class="type">Dog</span>()</span><br><span class="line">dog <span class="keyword">as</span> <span class="type">Animal</span>  <span class="comment">//把 dog 转换为 Animal 类型，向上转型成功，编译器不会报错</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">let</span> dog: <span class="type">Animal</span> <span class="operator">=</span> <span class="type">Dog</span>()</span><br><span class="line">dog <span class="keyword">as</span> <span class="type">Dog</span> <span class="comment">//编译错误，此时的变量 dog 在编译时是 Animal 类型，只能向上转换，无法向下转换。</span></span><br></pre></td></tr></table></figure>

<h2 id="as-as"><a href="#as-as" class="headerlink" title="as! as?"></a>as! as?</h2><p>运行时检测，downcast（向下转型，转换成其子类类型）<br>只不过前者是强制解包，解包失败就崩溃<br>后者是可选类型   </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面代码编译时均不会报错，因为 as! 和 as? 都是运行时检查的</span></span><br><span class="line"><span class="keyword">let</span> a: <span class="type">Animal</span> <span class="operator">=</span> <span class="type">Animal</span>()</span><br><span class="line">a <span class="keyword">as!</span> <span class="type">Dog</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">as!</span> <span class="type">Dog</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">as?</span> <span class="type">Dog</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>: <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;Spot&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dog: <span class="type">Animal</span> <span class="operator">=</span> <span class="type">Dog</span>()</span><br><span class="line"><span class="keyword">let</span> dog1 <span class="operator">=</span> dog <span class="keyword">as?</span> <span class="type">Dog</span> <span class="comment">//可选值</span></span><br><span class="line"><span class="keyword">let</span> dog2 <span class="operator">=</span> dog <span class="keyword">as!</span> <span class="type">Dog</span> <span class="comment">//强制解压</span></span><br><span class="line"></span><br><span class="line">dog1<span class="operator">?</span>.name <span class="comment">//可选调用</span></span><br><span class="line">dog2.name <span class="comment">//直接调用</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1、<code>as</code> 在编译时检测，<code>as!</code> <code>as?</code> 在运行时检测<br>2、<code>as</code> 可以用来指定文字表达类型以及向上转型<br>3、<code>as!</code> <code>as?</code> 用来向下转型，<code>as?</code> 转型后为可选值，<code>as!</code> 相当于在这个可选值上强制解压（可能会导致崩溃）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2020/08/Swift/%E5%9F%BA%E7%A1%80/Swift%20as%20as!%20as?%20%E7%9A%84%E7%90%86%E8%A7%A3/" data-id="cl7mpcyso006xgczy3d3nfe17" data-title="Swift as as! as? 的理解" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Swift/基础/Swift 什么是ABI稳定、模块稳定" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/Swift/%E5%9F%BA%E7%A1%80/Swift%20%E4%BB%80%E4%B9%88%E6%98%AFABI%E7%A8%B3%E5%AE%9A%E3%80%81%E6%A8%A1%E5%9D%97%E7%A8%B3%E5%AE%9A/" class="article-date">
  <time class="dt-published" datetime="2020-05-09T16:00:00.000Z" itemprop="datePublished">2020-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Swift/">Swift</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/Swift/%E5%9F%BA%E7%A1%80/Swift%20%E4%BB%80%E4%B9%88%E6%98%AFABI%E7%A8%B3%E5%AE%9A%E3%80%81%E6%A8%A1%E5%9D%97%E7%A8%B3%E5%AE%9A/">Swift 什么是ABI稳定、模块稳定</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="什么是ABI"><a href="#什么是ABI" class="headerlink" title="什么是ABI"></a>什么是ABI</h3><p>应用程序二进制接口（Application Binary Interface，ABI）是指两程序模块间的接口，通常其中一个程序模块会是库或操作系统所提供的服务，而另一边的模块则是用户所运行的程序。<br>ABI 约定了我们的应用程序怎样获取数据以及操作数据。应用程序就是通过这些ABI跟系统通信的。</p>
<h3 id="ABI稳定"><a href="#ABI稳定" class="headerlink" title="ABI稳定"></a>ABI稳定</h3><p>Swift 5.0 版本之前，应用程序打包时，都会将 Swift 标准库导入到二进制包中，原因是不同的 Swift 版本之间差异大，ABI接口不兼容。<br>Swift 5.0 开始 ABI 以及稳定。从 5.0 版本开始 Swift 共用一个 ABI 接口，所以从 5.0 版本开始打包时就不需要将 SWift 基础库打进二进制包中，此时iOS系统以及包含了这些基础库，这样做的好处是之一就是包体积变小了，启动时间变少了，更省内存了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">事实上，打包时还是会包含 Swift 基础库，原因是在 iOS 12.2 之前依然需要 Swift 基础库，但之后的版本 App Store 会自动移除。</span><br></pre></td></tr></table></figure>

<h3 id="模块稳定"><a href="#模块稳定" class="headerlink" title="模块稳定"></a>模块稳定</h3><p>Swift 5.1 之前，不同的版本生成的 Module（模块）只能在对应的版本上运行，不然就会出现以下错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Module compiled with Swift 5.0.1 cannot be imported by the Swift 5.1 compiler</span><br></pre></td></tr></table></figure>

<p>而从 5.1 版本开始， <code>Module Stability</code> 允许 5.1 版本打的 Module 在 5.1 之后的任意版本运行。</p>
<p>开启 <code>Module Stability</code> 后，Framework 引入了一个全新的文件夹 <code>.swiftmodule</code>，包含 <code>.swiftinterface</code> 和 <code>.swiftmodule</code> 文件，<code>swiftinterface</code> 文件作为 <code>swiftmodule</code> 的一个补充，用来描述 <code>module</code> 公开接口的文本文件，并且不受编译器版本限制，既通过 <code>swiftinterface</code> 文件可以将 Swift 6 打包的 framework 在 swift 7 版本下运行。</p>
<p>需要设置 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//BUILD_LIBRARY_FOR_DISTRIBUTION</span><br><span class="line">//Ensures that your libraries are built for distribution. </span><br><span class="line">//For Swift, this enables support for library evolution and generation of a module interface file.</span><br><span class="line">Build Libraries for Distribution = YES</span><br></pre></td></tr></table></figure>

<p>开启 <code>Build Libraries for Distribution</code> 后编译的文件如下<br><img src="https://gitee.com/vhuichen/images/raw/master/img/20210513181627.png"></p>
<p>如果不开启 <code>Build Libraries for Distribution</code> ，那么编译后会少了 <code>swiftinterface</code>， 此时的 <code>Module</code> 是受版本限制的。</p>
<h5 id="什么是-Library-Evolution"><a href="#什么是-Library-Evolution" class="headerlink" title="什么是 Library Evolution"></a>什么是 Library Evolution</h5><p>开启 <code>Library Evolution</code> 后，也就是<code>Build Libraries for Distribution</code>，当一个框架依赖另一个框架时，如果另一个框架发生改动，那么不需要重新编译第一个框架。也就是更新第二个框架不需要重新编译第一个框架。<br>类似于 <code>@frozen</code> ?</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://onevcat.com/2019/02/swift-abi/">Swift ABI 稳定对我们到底意味着什么</a><br><a target="_blank" rel="noopener" href="https://swift.org/blog/abi-stability-and-more/">ABI Stability and More</a><br><a target="_blank" rel="noopener" href="https://www.donnywals.com/what-is-module-stability-in-swift-and-why-should-you-care/">What is Module Stability in Swift and why should you care?</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2020/05/Swift/%E5%9F%BA%E7%A1%80/Swift%20%E4%BB%80%E4%B9%88%E6%98%AFABI%E7%A8%B3%E5%AE%9A%E3%80%81%E6%A8%A1%E5%9D%97%E7%A8%B3%E5%AE%9A/" data-id="cl7mpcysq0071gczyb31a42f0" data-title="Swift 什么是ABI稳定、模块稳定" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-iOS/CocoaPods之Profile" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/iOS/CocoaPods%E4%B9%8BProfile/" class="article-date">
  <time class="dt-published" datetime="2020-05-02T16:00:00.000Z" itemprop="datePublished">2020-05-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/iOS/CocoaPods%E4%B9%8BProfile/">CocoaPods之Profile</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Profile-详解"><a href="#Profile-详解" class="headerlink" title="Profile 详解"></a>Profile 详解</h1><h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">//限制最低版本，不限制的话可能会报错</span><br><span class="line">platform :ios, &#x27;9.0&#x27;</span><br><span class="line"></span><br><span class="line">//不提示第三方库的警告，如果有组件的</span><br><span class="line">inhibit_all_warnings!</span><br><span class="line"></span><br><span class="line">//使用静态库</span><br><span class="line">use_modular_headers!</span><br><span class="line">//动态库</span><br><span class="line">use_frameworks!</span><br><span class="line"></span><br><span class="line">//支持的swift版本</span><br><span class="line">supports_swift_versions &#x27;&gt;= 5.0&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//声明使用的安装方法和选项，install! 函数只能调用一次</span><br><span class="line">install!</span><br><span class="line">//目前只允许通过 cocoapods 安装</span><br><span class="line">install! &#x27;cocoapods&#x27;,</span><br><span class="line"></span><br><span class="line">支持的key ,显示的是默认值</span><br><span class="line"></span><br><span class="line">//清理pod没有使用的所有文件</span><br><span class="line">:clean =&gt; true</span><br><span class="line"></span><br><span class="line">//是否复制pod的target</span><br><span class="line">:deduplicate_targets =&gt; true</span><br><span class="line"></span><br><span class="line">//是否生成uuid</span><br><span class="line">:deterministic_uuids =&gt; true</span><br><span class="line"></span><br><span class="line">//是否将安装的pods集成到项目中</span><br><span class="line">//如果设置为false, Pods将被下载并安装到Pods/目录中，但不会集成到项目中</span><br><span class="line">:integrate_targets =&gt; true</span><br><span class="line"></span><br><span class="line">//锁定pods的源文件</span><br><span class="line">:lock_pod_sources =&gt; true</span><br><span class="line"></span><br><span class="line">//多个源包含相同名称和版本的Pod时发出警告</span><br><span class="line">:warn_for_multiple_pod_sources =&gt; true</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">:share_schemes_for_development_pods =&gt; false</span><br><span class="line"></span><br><span class="line">//禁用CocoaPods脚本阶段的输入和输出路径(复制框架和复制资源)</span><br><span class="line">//可以解决修改了私有库代码后，无法立即生效的问题</span><br><span class="line">:disable_input_output_paths =&gt; false</span><br><span class="line"></span><br><span class="line">//是否保留所有pod的文件结构，包括外部pod源。</span><br><span class="line">//默认情况下，Pod源的文件结构仅为开发Pod保留。</span><br><span class="line">//设置:preserve_pod_file_structure为true将始终保存文件结构。</span><br><span class="line">:preserve_pod_file_structure =&gt; false</span><br><span class="line"></span><br><span class="line">//是否为每个pod目标生成一个项目，而不是创建一个Pods.xcodeproj，此选项将为嵌套在Pods.xcodeproj下的每个pod目标生成一个项目。</span><br><span class="line">//使用此选项可以加快编译速度</span><br><span class="line">:generate_multiple_pod_projects =&gt; false</span><br><span class="line"></span><br><span class="line">//是否仅启用自上次安装以来已更改的重新生成目标及其关联项目。</span><br><span class="line">:incremental_installation =&gt; false</span><br><span class="line"></span><br><span class="line">//是否跳过生成Pods.xcodeproj，只执行依赖项解析和下载。</span><br><span class="line">:skip_pods_project_generation</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="0x01-关键字"><a href="#0x01-关键字" class="headerlink" title="0x01 关键字"></a>0x01 关键字</h2><h4 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h4><p>指定项目的依赖项。依赖项需求由Pod的名称和版本需求列表(可选)定义。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pod &#x27;Objection&#x27;, &#x27;0.9&#x27;</span><br><span class="line">//</span><br><span class="line">= 0.1，版本0.1。  </span><br><span class="line">&gt; 0.1，任何高于0.1的版本。</span><br><span class="line">&gt;= 0.1，版本0.1和任何更高版本。</span><br><span class="line">&lt; 0.1，任何低于0.1的版本。</span><br><span class="line">&lt;= 0.1，版本0.1和任何较低版本。</span><br><span class="line">~&gt; 0.1.2，版本0.1.2及以上到版本0.2，不含0.2。该操作符基于你在版本需求中指定的最后一个组件工作。这个例子等于&gt;= 0.1.2与&lt; 0.2.0相结合，并且总是匹配与你的需求相匹配的最新已知版本。</span><br><span class="line">~ &gt; 0.1.3-beta.0，Beta版和release发行版本为0.1.3，发行版本为0.2(不包括0.2)。用破折号(-)分隔的组件将不考虑版本要求。</span><br></pre></td></tr></table></figure>

<h4 id="configurations"><a href="#configurations" class="headerlink" title="configurations"></a>configurations</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pod &#x27;PonyDebugger&#x27;, :configurations =&gt; [&#x27;Debug&#x27;, &#x27;Beta&#x27;]</span><br><span class="line">pod &#x27;PonyDebugger&#x27;, :configuration =&gt; &#x27;Debug&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="modular-headers"><a href="#modular-headers" class="headerlink" title="modular_headers"></a>modular_headers</h4><p>模块化，当你使用 use_modular_headers! 属性时，可以从模块头中排除特定的Pod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &#x27;SSZipArchive&#x27;, :modular_headers =&gt; false</span><br></pre></td></tr></table></figure>

<h4 id="source-path"><a href="#source-path" class="headerlink" title="source path"></a>source path</h4><p>源，默认情况下，在全局级别指定的源按照指定依赖项匹配的顺序进行搜索。这种行为可以通过指定依赖项的来源来改变特定的依赖项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pod &#x27;PonyDebugger&#x27;, :source =&gt; &#x27;https://github.com/CocoaPods/Specs.git&#x27;</span><br><span class="line">pod &#x27;AFNetworking&#x27;, :path =&gt; &#x27;~/Documents/AFNetworking&#x27;</span><br><span class="line">pod &#x27;AFNetworking&#x27;, :git =&gt; &#x27;https://github.com/gowalla/AFNetworking.git&#x27;, :branch =&gt; &#x27;dev&#x27;</span><br><span class="line">pod &#x27;AFNetworking&#x27;, :git =&gt; &#x27;https://github.com/gowalla/AFNetworking.git&#x27;, :tag =&gt; &#x27;0.7.0&#x27;</span><br><span class="line">pod &#x27;AFNetworking&#x27;, :git =&gt; &#x27;https://github.com/gowalla/AFNetworking.git&#x27;, :commit =&gt; &#x27;082f8319af&#x27;</span><br><span class="line">pod &#x27;JSONKit&#x27;, :podspec =&gt; &#x27;https://example.com/JSONKit.podspec&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Subspecs"><a href="#Subspecs" class="headerlink" title="Subspecs"></a>Subspecs</h4><p>当通过它的名字安装Pod时，它将安装podspec中定义的所有默认的子规范。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pod &#x27;QueryKit/Attribute&#x27;</span><br><span class="line">pod &#x27;QueryKit&#x27;, :subspecs =&gt; [&#x27;Attribute&#x27;, &#x27;QuerySet&#x27;]</span><br></pre></td></tr></table></figure>

<h4 id="testspecs"><a href="#testspecs" class="headerlink" title="testspecs"></a>testspecs</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pod &#x27;AFNetworking&#x27;, :testspecs =&gt; [&#x27;UnitTests&#x27;, &#x27;SomeOtherTests&#x27;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="abstract-target"><a href="#abstract-target" class="headerlink" title="abstract_target"></a>abstract_target</h4><p>定义一个新的抽象目标，可用于方便的目标依赖项继承。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">abstract_target &#x27;Networking&#x27; do</span><br><span class="line">  pod &#x27;AlamoFire&#x27;</span><br><span class="line">  </span><br><span class="line">  target &#x27;ShowsiOS&#x27; do</span><br><span class="line">    pod &#x27;ShowWebAuth&#x27;</span><br><span class="line">  end</span><br><span class="line"> </span><br><span class="line">  target &#x27;ShowsTV&#x27; do</span><br><span class="line">    pod &#x27;ShowTVAuth&#x27;</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h4 id="def"><a href="#def" class="headerlink" title="def"></a>def</h4><p>预定义模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def debug_pods</span><br><span class="line">  pod &#x27;LookinServer&#x27;, :configurations =&gt; [&#x27;Debug&#x27;]</span><br><span class="line">  pod &#x27;MLeaksFinder&#x27;, :configurations =&gt; [&#x27;Debug&#x27;]</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2020/05/iOS/CocoaPods%E4%B9%8BProfile/" data-id="cl7mpcyqr000vgczyasgsg6fp" data-title="CocoaPods之Profile" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CocoaPods/" rel="tag">CocoaPods</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Profile/" rel="tag">Profile</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Swift/基础/Swift 访问权限修饰符" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/Swift/%E5%9F%BA%E7%A1%80/Swift%20%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6/" class="article-date">
  <time class="dt-published" datetime="2020-04-26T16:00:00.000Z" itemprop="datePublished">2020-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Swift/">Swift</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/Swift/%E5%9F%BA%E7%A1%80/Swift%20%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6/">Swift 访问权限修饰符</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Swift-访问权限修饰符"><a href="#Swift-访问权限修饰符" class="headerlink" title="Swift 访问权限修饰符"></a>Swift 访问权限修饰符</h2><p>swift 的设计目标之一就是安全类型语言（Designed for Safety），所以多几个<code>访问修饰符</code>也是合情合理的。<br>访问修饰符可以用来修饰<code>属性</code>、<code>方法</code>、<code>类</code>、<code>结构体</code></p>
<h4 id="private"><a href="#private" class="headerlink" title="private"></a>private</h4><p>只能在当前类里使用，不允许外部或者其子类访问。如果用来修饰类、结构体，那么作用相当于<code>fileprivate</code></p>
<blockquote>
<p>private(set) 表示禁止设置，即只读，可访问</p>
</blockquote>
<h4 id="fileprivate"><a href="#fileprivate" class="headerlink" title="fileprivate"></a>fileprivate</h4><p>只能在当前的源文件里使用</p>
<h4 id="internal（默认）"><a href="#internal（默认）" class="headerlink" title="internal（默认）"></a>internal（默认）</h4><p>可以在源代码所在的模块使用  </p>
<h4 id="public"><a href="#public" class="headerlink" title="public"></a>public</h4><p>可以在模块之外使用，但不可以在其它模块中重写和继承</p>
<h4 id="open"><a href="#open" class="headerlink" title="open"></a>open</h4><p>可以在模块之外使用，也可以在其它模块中重写和继承</p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p><strong>在一个 Framework 里，既有 Swift 又有 OC 代码时，编译器会将 Swift 和 OC 分别当成一个 Module 。Swift 代码除了使用关键字 <code>@objc</code> 外，还必须使用 <code>public </code> 级别的关键字才能被同一个 Framework 里的 OC 代码使用</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2020/04/Swift/%E5%9F%BA%E7%A1%80/Swift%20%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6/" data-id="cl7mpcysq0074gczyfetr5ksv" data-title="Swift 访问权限修饰符" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2019/05/记一次代码优化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/2019/05/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2019-05-02T16:00:00.000Z" itemprop="datePublished">2019-05-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%87%8D%E6%9E%84/">重构</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/2019/05/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96/">记一次代码优化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><blockquote>
<p>下拉刷新某个主页面，需要刷新这个主页面里的所有子页面，每个子页面都是一个独立的模块，也就是要等到所有的模块都请求完成时，主页面的刷新才能结束,并执行一系列相应的操作。   </p>
</blockquote>
<p>以上就是一个完成的需求，OK，开始写代码，第一版的代码思路是这样的</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> dataCallbackCount;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)refreshView &#123;</span><br><span class="line">	<span class="keyword">self</span>.dataCallbackCount = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData0lWithComplete:^&#123;</span><br><span class="line">		<span class="keyword">self</span>.dataCallbackCount++;</span><br><span class="line">		[<span class="keyword">self</span> shouldEndRefresh:dataCallbackCount];</span><br><span class="line">	&#125;];</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData1lWithComplete:^&#123;</span><br><span class="line">		<span class="keyword">self</span>.dataCallbackCount++;</span><br><span class="line">		[<span class="keyword">self</span> shouldEndRefresh:dataCallbackCount];</span><br><span class="line">	&#125;];</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData2lWithComplete:^&#123;</span><br><span class="line">		<span class="keyword">self</span>.dataCallbackCount++;</span><br><span class="line">		[<span class="keyword">self</span> shouldEndRefresh:dataCallbackCount];</span><br><span class="line">	&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)shouldEndRefresh:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="keyword">if</span> (count &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.refreshView endRefresh];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一版的代码有个问题，dataCallbackCount 属性和 shouldEndRefresh 方法 都是刷新方法内部才需要使用的，现在都变成类内部全局的了，其他的方法也可以使用这个属性和方法，而且 dataCallbackCount 还一直占用内存，这是不应该的。<br>我们知道block可以捕获变量，方法也可以用block代替。那么第二版改动如下：  </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)refreshView &#123;</span><br><span class="line">    __block <span class="built_in">NSInteger</span> dataCallbackCount = <span class="number">0</span>;</span><br><span class="line">	 </span><br><span class="line">    <span class="type">void</span> (^shouldEndRefresh)(<span class="type">void</span>) = ^(<span class="type">void</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (++dataCallbackCount &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.refreshView endRefresh];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData0lWithComplete:^&#123;</span><br><span class="line">		shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData1lWithComplete:^&#123;</span><br><span class="line">		shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData2lWithComplete:^&#123;</span><br><span class="line">		shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二版我们将所有的代码都放到一个方法内了，同时也将 self.dataCallbackCount++; 放到了block内部，避免多次调用。dataCallbackCount 这个变量也会在结束刷新后释放内存，对于外部来说只需要调用 refreshView 就可以了，这样显得内聚很多。<br>但是仔细看的话，又会发现现在的 dataCallbackCount 也只是 shouldEndRefresh 内部需要使用而已 对于 [self.viewModel fetchxxx] 方法来说也应该是不可见的，但显然目前的这种写法是可见的。于是第三版改动如下：   </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)refreshView &#123;</span><br><span class="line">    <span class="type">void</span> (^_shouldEndRefresh)(<span class="type">void</span>) = ^(<span class="built_in">NSInteger</span> dataCallbackCountMax) &#123;</span><br><span class="line">        __block <span class="built_in">NSInteger</span> dataCallbackCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ^&#123;</span><br><span class="line">            <span class="keyword">if</span> (++dataCallbackCount &gt;= dataCallbackCountMax) &#123;</span><br><span class="line">                [<span class="keyword">self</span>.refreshView endRefresh];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;(<span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData0lWithComplete:^&#123;</span><br><span class="line">		_shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData1lWithComplete:^&#123;</span><br><span class="line">		_shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData2lWithComplete:^&#123;</span><br><span class="line">		_shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>优化结束，如果需要优化的话可以将 [self.refreshView endRefresh]; 方法抽出来。最终代码如下： </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)refreshViewWithCallBack:(<span class="type">void</span>(^)(<span class="type">void</span>))callback &#123;</span><br><span class="line">    <span class="type">void</span> (^_shouldEndRefresh)(<span class="type">void</span>) = ^(<span class="built_in">NSInteger</span> dataCallbackCountMax) &#123;</span><br><span class="line">        __block <span class="built_in">NSInteger</span> dataCallbackCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ^&#123;</span><br><span class="line">            <span class="keyword">if</span> (++dataCallbackCount &gt;= dataCallbackCountMax) &#123;</span><br><span class="line">                callback ? callback() : <span class="literal">nil</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;(<span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData0lWithComplete:^&#123;</span><br><span class="line">		_shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData1lWithComplete:^&#123;</span><br><span class="line">		_shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span>.viewModel fetchData2lWithComplete:^&#123;</span><br><span class="line">		_shouldEndRefresh();</span><br><span class="line">	&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>-END-</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://vhuichen.github.io/2019/05/2019/05/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96/" data-id="cl7mpcyrh0033gczy9xj6guje" data-title="记一次代码优化" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%87%8D%E6%9E%84/" rel="tag">重构</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/GitHub/">GitHub</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Swift/">Swift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/Swift/">Swift</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS%E5%9F%BA%E7%A1%80/">iOS基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS%E5%BC%80%E5%8F%91/">iOS开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">网络协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%87%8D%E6%9E%84/">重构</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AES/" rel="tag">AES</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/APP%E9%BB%98%E8%AE%A4%E8%AF%AD%E8%A8%80/" rel="tag">APP默认语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Allocations/" rel="tag">Allocations</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Base64/" rel="tag">Base64</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bugly/" rel="tag">Bugly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CADisplayLink/" rel="tag">CADisplayLink</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CocoaPods/" rel="tag">CocoaPods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocoapods/" rel="tag">Cocoapods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cornerstone/" rel="tag">Cornerstone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Designated-Initializer/" rel="tag">Designated Initializer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Effective-Objective-C-2-0/" rel="tag">Effective Objective-C 2.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FMDB/" rel="tag">FMDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GCD/" rel="tag">GCD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub-Desktop/" rel="tag">GitHub Desktop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Instruments/" rel="tag">Instruments</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KCP/" rel="tag">KCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MD5/" rel="tag">MD5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVC/" rel="tag">MVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVP/" rel="tag">MVP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVVM/" rel="tag">MVVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Module/" rel="tag">Module</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSHTTPCookie/" rel="tag">NSHTTPCookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSHTTPCookieStorage/" rel="tag">NSHTTPCookieStorage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSNumericSearch/" rel="tag">NSNumericSearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSOperation/" rel="tag">NSOperation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSPredicate/" rel="tag">NSPredicate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSString/" rel="tag">NSString</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSThread/" rel="tag">NSThread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSTimeZone/" rel="tag">NSTimeZone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NavigationItem/" rel="tag">NavigationItem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Profile/" rel="tag">Profile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Push-Notification/" rel="tag">Push Notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SRWebSocket/" rel="tag">SRWebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVN/" rel="tag">SVN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Singleton/" rel="tag">Singleton</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Socket/" rel="tag">Socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift%E6%B7%B7%E7%BC%96/" rel="tag">Swift混编</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/" rel="tag">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UIImage/" rel="tag">UIImage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UINavigationBar/" rel="tag">UINavigationBar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UITableViewCell/" rel="tag">UITableViewCell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UITextField/" rel="tag">UITextField</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/URL-Schemes/" rel="tag">URL Schemes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/View/" rel="tag">View</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Workspace/" rel="tag">Workspace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anchorPoint/" rel="tag">anchorPoint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hash/" rel="tag">hash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/initialize/" rel="tag">initialize</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/isEqual/" rel="tag">isEqual</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libffi/" rel="tag">libffi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/load/" rel="tag">load</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%93%E7%A7%AF%E5%8C%85%E4%BC%98%E5%8C%96/" rel="tag">体积包优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/" rel="tag">关联对象</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" rel="tag">内存管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%87%E6%8D%A2%E6%A0%B9%E6%8E%A7%E5%88%B6%E5%99%A8/" rel="tag">切换根控制器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/" rel="tag">加密解密</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E4%BE%8B/" rel="tag">单例</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" rel="tag">单元测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9C%B0%E5%9B%BE/" rel="tag">地图</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96/" rel="tag">尾调用优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D/" rel="tag">数据去重</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/" rel="tag">时间复杂度</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/" rel="tag">消息转发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/" rel="tag">热更新</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AC%A6%E5%8F%B7%E8%A1%A8/" rel="tag">符号表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/" rel="tag">第三方登录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B1%BB%E5%AF%B9%E8%B1%A1%E6%9C%AC%E8%B4%A8/" rel="tag">类对象本质</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B1%BB%E6%97%8F%E6%A8%A1%E5%BC%8F/" rel="tag">类族模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%A6%E6%9D%9F/" rel="tag">约束</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B/" rel="tag">线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E6%97%B6/" rel="tag">编译时</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95/" rel="tag">自动登录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E9%87%8A%E6%94%BE%E6%B1%A0/" rel="tag">自动释放池</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%90%E8%A1%8C%E6%97%B6/" rel="tag">运行时</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9B%E7%A8%8B/" rel="tag">进程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%9E%84/" rel="tag">重构</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AES/" style="font-size: 10px;">AES</a> <a href="/tags/APP%E9%BB%98%E8%AE%A4%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">APP默认语言</a> <a href="/tags/Allocations/" style="font-size: 10px;">Allocations</a> <a href="/tags/Base64/" style="font-size: 10px;">Base64</a> <a href="/tags/Bugly/" style="font-size: 10px;">Bugly</a> <a href="/tags/CADisplayLink/" style="font-size: 10px;">CADisplayLink</a> <a href="/tags/CocoaPods/" style="font-size: 13.33px;">CocoaPods</a> <a href="/tags/Cocoapods/" style="font-size: 10px;">Cocoapods</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/Cornerstone/" style="font-size: 10px;">Cornerstone</a> <a href="/tags/Designated-Initializer/" style="font-size: 10px;">Designated Initializer</a> <a href="/tags/Effective-Objective-C-2-0/" style="font-size: 20px;">Effective Objective-C 2.0</a> <a href="/tags/FMDB/" style="font-size: 10px;">FMDB</a> <a href="/tags/GCD/" style="font-size: 13.33px;">GCD</a> <a href="/tags/GitHub-Desktop/" style="font-size: 10px;">GitHub Desktop</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hexo/" style="font-size: 13.33px;">Hexo</a> <a href="/tags/Instruments/" style="font-size: 10px;">Instruments</a> <a href="/tags/KCP/" style="font-size: 10px;">KCP</a> <a href="/tags/MD5/" style="font-size: 10px;">MD5</a> <a href="/tags/MVC/" style="font-size: 10px;">MVC</a> <a href="/tags/MVP/" style="font-size: 10px;">MVP</a> <a href="/tags/MVVM/" style="font-size: 10px;">MVVM</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Module/" style="font-size: 10px;">Module</a> <a href="/tags/NSHTTPCookie/" style="font-size: 10px;">NSHTTPCookie</a> <a href="/tags/NSHTTPCookieStorage/" style="font-size: 10px;">NSHTTPCookieStorage</a> <a href="/tags/NSNumericSearch/" style="font-size: 10px;">NSNumericSearch</a> <a href="/tags/NSOperation/" style="font-size: 10px;">NSOperation</a> <a href="/tags/NSPredicate/" style="font-size: 10px;">NSPredicate</a> <a href="/tags/NSString/" style="font-size: 10px;">NSString</a> <a href="/tags/NSThread/" style="font-size: 10px;">NSThread</a> <a href="/tags/NSTimeZone/" style="font-size: 10px;">NSTimeZone</a> <a href="/tags/NavigationItem/" style="font-size: 10px;">NavigationItem</a> <a href="/tags/Profile/" style="font-size: 10px;">Profile</a> <a href="/tags/Push-Notification/" style="font-size: 10px;">Push Notification</a> <a href="/tags/SRWebSocket/" style="font-size: 10px;">SRWebSocket</a> <a href="/tags/SVN/" style="font-size: 16.67px;">SVN</a> <a href="/tags/Singleton/" style="font-size: 10px;">Singleton</a> <a href="/tags/Socket/" style="font-size: 10px;">Socket</a> <a href="/tags/Swift/" style="font-size: 13.33px;">Swift</a> <a href="/tags/Swift%E6%B7%B7%E7%BC%96/" style="font-size: 10px;">Swift混编</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/UIImage/" style="font-size: 10px;">UIImage</a> <a href="/tags/UINavigationBar/" style="font-size: 10px;">UINavigationBar</a> <a href="/tags/UITableViewCell/" style="font-size: 10px;">UITableViewCell</a> <a href="/tags/UITextField/" style="font-size: 10px;">UITextField</a> <a href="/tags/URL-Schemes/" style="font-size: 10px;">URL Schemes</a> <a href="/tags/View/" style="font-size: 10px;">View</a> <a href="/tags/WebSocket/" style="font-size: 16.67px;">WebSocket</a> <a href="/tags/Workspace/" style="font-size: 10px;">Workspace</a> <a href="/tags/anchorPoint/" style="font-size: 10px;">anchorPoint</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hash/" style="font-size: 10px;">hash</a> <a href="/tags/initialize/" style="font-size: 10px;">initialize</a> <a href="/tags/isEqual/" style="font-size: 10px;">isEqual</a> <a href="/tags/libffi/" style="font-size: 10px;">libffi</a> <a href="/tags/load/" style="font-size: 10px;">load</a> <a href="/tags/%E4%BD%93%E7%A7%AF%E5%8C%85%E4%BC%98%E5%8C%96/" style="font-size: 10px;">体积包优化</a> <a href="/tags/%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/" style="font-size: 10px;">关联对象</a> <a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size: 10px;">内存管理</a> <a href="/tags/%E5%88%87%E6%8D%A2%E6%A0%B9%E6%8E%A7%E5%88%B6%E5%99%A8/" style="font-size: 10px;">切换根控制器</a> <a href="/tags/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/" style="font-size: 10px;">加密解密</a> <a href="/tags/%E5%8D%95%E4%BE%8B/" style="font-size: 10px;">单例</a> <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">单元测试</a> <a href="/tags/%E5%9C%B0%E5%9B%BE/" style="font-size: 10px;">地图</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">多线程</a> <a href="/tags/%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96/" style="font-size: 10px;">尾调用优化</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D/" style="font-size: 10px;">数据去重</a> <a href="/tags/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/" style="font-size: 10px;">时间复杂度</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 10px;">框架</a> <a href="/tags/%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/" style="font-size: 10px;">消息转发</a> <a href="/tags/%E7%83%AD%E6%9B%B4%E6%96%B0/" style="font-size: 10px;">热更新</a> <a href="/tags/%E7%AC%A6%E5%8F%B7%E8%A1%A8/" style="font-size: 10px;">符号表</a> <a href="/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/" style="font-size: 10px;">第三方登录</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%B1%BB%E5%AF%B9%E8%B1%A1%E6%9C%AC%E8%B4%A8/" style="font-size: 10px;">类对象本质</a> <a href="/tags/%E7%B1%BB%E6%97%8F%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">类族模式</a> <a href="/tags/%E7%BA%A6%E6%9D%9F/" style="font-size: 10px;">约束</a> <a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">线程</a> <a href="/tags/%E7%BC%96%E8%AF%91%E6%97%B6/" style="font-size: 10px;">编译时</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95/" style="font-size: 10px;">自动登录</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E9%87%8A%E6%94%BE%E6%B1%A0/" style="font-size: 10px;">自动释放池</a> <a href="/tags/%E8%BF%90%E8%A1%8C%E6%97%B6/" style="font-size: 10px;">运行时</a> <a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size: 10px;">进程</a> <a href="/tags/%E9%87%8D%E6%9E%84/" style="font-size: 10px;">重构</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/05/NetworkProtocol/KCP/KCP/">KCP 协议</a>
          </li>
        
          <li>
            <a href="/2022/04/iOS/libffi%E6%8E%A2%E7%A9%B6%20/">libffi 探究</a>
          </li>
        
          <li>
            <a href="/2022/03/iOS/iOS%E5%AF%B9%E8%B1%A1%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%8A%A0%E5%85%A5%E8%87%AA%E5%8A%A8%E9%87%8A%E6%94%BE%E6%B1%A0/">ARC下，对象什么时候加入自动释放池</a>
          </li>
        
          <li>
            <a href="/2022/01/NetworkProtocol/WebSocket/WebSocket/">WebSocket</a>
          </li>
        
          <li>
            <a href="/2021/10/NetworkProtocol/SRWebSocket/SRWebSocket/">SRWebSocket 源码解析</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 vhuichen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>